<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng T√≠nh L∆∞∆°ng</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="icon" href="https://i.ibb.co/TqKdtqPL/18143710-3-E23-4754-A7-BD-E56-F73-CC1-E8-E.jpg" type="image/jpg" sizes="32x32">
    <link rel="apple-touch-icon" href="https://iibb.co/TqKdtqPL/18143710-3-E23-4754-A7-BD-E56-F73-CC1-E8-E.jpg" sizes="180x180">
    <link rel="icon" href="https://iibb.co/TqKdtqPL/18143710-3-E23-4754-A7-BD-E56-F73-CC1-E8-E.jpg" type="image/jpg" sizes="192x192">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- NH·∫¨P C·∫¢ HAI FONT CH·ªÆ --- */
        @import url('https://fonts.googleapis.com/css2?family=Lobster&family=Roboto:wght@400;700;900&display=swap');
        
        body {
            /* D√πng Roboto cho vƒÉn b·∫£n th√¥ng th∆∞·ªùng ƒë·ªÉ d·ªÖ ƒë·ªçc */
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
        }
        
        /* --- √ÅP D·ª§NG FONT LOBSTER CHO TI√äU ƒê·ªÄ CH√çNH --- */
        .lobster-title {
            font-family: 'Roboto', sans-serif;
            /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc/ƒë·ªô ƒë·∫≠m cho n·ªïi b·∫≠t h∆°n */
            font-weight: 400; /* Lobster ch·ªâ c√≥ 1 ƒë·ªô ƒë·∫≠m */
            letter-spacing: 1px;
            color: #1f2937; /* Gray 800 */
        }
        
        /* C√°c style kh√°c gi·ªØ nguy√™n */
        .section-title {
            position: relative;
            padding-left: 1.5rem;
        }
        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 80%;
            background-color: #3b82f6; /* Blue 500 */
            border-radius: 4px;
            transition: height 0.3s ease; 
        }
        .section-title:hover::before {
             height: 100%; 
        }
        .input-group label {
            font-size: 0.875rem; 
            font-weight: 500; 
            color: #374151; 
        }
        .result-value {
            font-weight: 700;
            color: #16a34a; /* green-600 */
            transition: all 0.2s ease-out; 
        }
        .final-result {
            font-size: 1.5rem; 
            color: #b91c1c; /* red-700 */
        }

        /* --- KEYFRAMES CHO ANIMATION --- */

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-on-load {
            animation: fadeIn 0.8s ease-out forwards;
        }

        @keyframes inputFocusBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .input-bounce-effect:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); 
            animation: inputFocusBounce 0.3s ease-out;
        }
        
        @keyframes resultUpdate {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.03); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-update {
            animation: resultUpdate 0.4s ease-out;
        }

        /* --- STYLE CHO BONG B√ìNG N·ªîI TH·ª∞C L√ÉNH (FAB) --- */
        #floating-result-bubble {
            position: fixed; 
            bottom: 1.5rem; 
            right: 1.5rem;  
            z-index: 100;   
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%); 
            border: 2px solid rgba(255, 255, 255, 0.5); 
            cursor: pointer;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        }
        
        @keyframes bubbleUpdate {
            0% { transform: scale(1); box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
            50% { transform: scale(1.05); box-shadow: 0 0 25px #fef2f2, 0 10px 15px -3px rgba(0, 0, 0, 0.3); }
            100% { transform: scale(1); box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        }
        
        .animate-update-bubble {
            animation: bubbleUpdate 0.5s ease-out;
        }

        /* --- STYLE CHO MODAL M·ªöI --- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* L·ªõp ph·ªß l√†m m·ªù */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200; /* Cao h∆°n FAB */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            max-width: 90%;
            width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            transform: scale(0.9);
            transition: transform 0.3s ease-out;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    
    <div id="timesheet-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 class="text-2xl font-bold text-blue-700 mb-4 border-b-2 pb-2 flex justify-between items-center">
                Nh·∫≠p S·ªë Li·ªáu C√¥ng Chi Ti·∫øt
                <button onclick="closeModal()" class="text-gray-500 hover:text-red-600 text-3xl leading-none">&times;</button>
            </h3>
            
            <div class="space-y-4">
                <div class="input-group">
                    <label for="modal_ngay_di_lam" class="text-sm font-medium text-gray-700">S·ªë Ng√†y ƒêi L√†m</label>
                    <input type="number" id="modal_ngay_di_lam" value="0" min="0" 
                           onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                           class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 transition duration-150 input-bounce-effect">
                </div>
                
                <h4 class="text-lg font-bold text-purple-700 mt-6 mb-2">Gi·ªù TƒÉng Ca (Theo B·∫£ng C√¥ng)</h4>
                <div class="grid grid-cols-3 gap-4">
                    <div class="input-group">
                        <label for="modal_tc_thuong" class="text-sm">TC Th∆∞·ªùng</label>
                        <input type="number" id="modal_tc_thuong" value="0" min="0" 
                               onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                               class="w-full p-2 border border-purple-300 rounded-md input-bounce-effect">
                    </div>
                    <div class="input-group">
                        <label for="modal_tc_nghi" class="text-sm">TC Ng√†y Ngh·ªâ</label>
                        <input type="number" id="modal_tc_nghi" value="0" min="0" 
                               onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                               class="w-full p-2 border border-purple-300 rounded-md input-bounce-effect">
                    </div>
                    <div class="input-group">
                        <label for="modal_tc_le" class="text-sm">TC Ng√†y L·ªÖ</label>
                        <input type="number" id="modal_tc_le" value="0" min="0" 
                               onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                               class="w-full p-2 border border-purple-300 rounded-md input-bounce-effect">
                    </div>
                </div>

                <h4 class="text-lg font-bold text-red-700 mt-6 mb-2">Gi·ªù Ca ƒê√™m (Theo Ph·ª• C·∫•p)</h4>
                 <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label for="modal_cd_30" class="text-sm">Ca ƒê√™m 30%</label>
                        <input type="number" id="modal_cd_30" value="0" min="0" 
                               onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                               class="w-full p-2 border border-red-300 rounded-md input-bounce-effect">
                    </div>
                    <div class="input-group">
                        <label for="modal_cd_50" class="text-sm">Ca ƒê√™m 50%</label>
                        <input type="number" id="modal_cd_50" value="0" min="0" 
                               onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                               class="w-full p-2 border border-red-300 rounded-md input-bounce-effect">
                    </div>
                    <div class="input-group">
                        <label for="modal_cd_70" class="text-sm">Ca ƒê√™m 70%</label>
                        <input type="number" id="modal_cd_70" value="0" min="0" 
                               onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                               class="w-full p-2 border border-red-300 rounded-md input-bounce-effect">
                    </div>
                    <div class="input-group">
                        <label for="modal_cd_90" class="text-sm">Ca ƒê√™m 90%</label>
                        <input type="number" id="modal_cd_90" value="0" min="0" 
                               onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                               class="w-full p-2 border border-red-300 rounded-md input-bounce-effect">
                    </div>
                 </div>
            </div>
            
            <button onclick="applyModalData()" 
                    class="mt-6 w-full bg-blue-600 hover:bg-blue-700 active:scale-95 text-white font-bold py-3 px-4 rounded-lg transition duration-150 shadow-md flex items-center justify-center">
                ‚úÖ √Åp D·ª•ng D·ªØ Li·ªáu
            </button>
            <p class="text-xs text-center text-gray-500 mt-2">S·ªë li·ªáu n√†y s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn v√†o 'TƒÉng Ca v√† Ca ƒë√™m' ·ªü d∆∞·ªõi.</p>
        </div>
    </div>
    
    <div id="floating-result-bubble" 
         class="fixed bottom-6 right-6 z-50 p-4 rounded-xl shadow-2xl transition duration-300 transform scale-100 hover:scale-[1.05] cursor-pointer">
        <p class="text-xs font-medium text-white/80">TH·ª∞C L√ÉNH</p>
        <p id="thuc_lanh_fab" class="text-xl font-extrabold text-white mt-1 result-display drop-shadow-lg">0 VNƒê</p>
    </div>
    
    <div class="max-w-3xl mx-auto mb-6">
        <p class="text-center">
            <a href="tinhgio.html" 
               class="inline-block bg-pink-600 hover:bg-pink-700 active:scale-95 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition duration-150">
                üöÄ M·ªü C√¥ng C·ª• T√≠nh L·ªãch Tr√¨nh Ch·∫°y M√°y
            </a>
        </p>
    </div>
    <div class="max-w-3xl mx-auto bg-white shadow-2xl rounded-xl p-4 sm:p-6 lg:p-8 fade-in-on-load">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-6 border-b-4 border-blue-500 pb-2 lobster-title">
            B·∫£ng T√≠nh L∆∞∆°ng HYOSUNG
        </h1>

        <div id="preset-manager" class="bg-gray-100 p-5 rounded-xl shadow-lg mb-8 border-t-4 border-purple-500 transition duration-300 hover:shadow-xl">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">üë§</span> Qu·∫£n L√Ω Preset C√° Nh√¢n
            </h2>

            <div class="grid grid-cols-3 gap-3 mb-4">
                <div class="col-span-2">
                    <label for="preset_select" class="text-sm font-medium text-purple-700">Ch·ªçn Preset ƒê√£ L∆∞u</label>
                    <select id="preset_select" 
                            class="w-full p-2 border border-purple-300 rounded-md bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-150 hover:border-purple-500">
                        <option value="">-- Ch·ªçn Preset --</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button id="load_preset_btn" class="w-full bg-purple-600 hover:bg-purple-700 active:scale-95 text-white font-bold py-2 px-4 rounded-md transition duration-150 shadow-md disabled:bg-gray-400 disabled:shadow-none">
                        T·∫£i Preset
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t pt-4">
                
                <div>
                    <label for="preset_name_input" class="text-sm font-medium text-green-700">T√™n Preset M·ªõi / C·∫≠p nh·∫≠t</label>
                    <input type="text" id="preset_name_input" placeholder="V√≠ d·ª•: Nghƒ©a" 
                           class="w-full p-2 border border-green-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-150 input-bounce-effect">
                </div>
                
                <div class="flex items-end space-x-2">
                    <button id="save_preset_btn" class="w-1/2 bg-green-600 hover:bg-green-700 active:scale-95 text-white font-bold py-2 px-4 rounded-md transition duration-150 shadow-md">
                        L∆∞u Preset
                    </button>
                    <button id="delete_preset_btn" class="w-1/2 bg-red-500 hover:bg-red-600 active:scale-95 text-white font-bold py-2 px-4 rounded-md transition duration-150 shadow-md disabled:bg-red-300 disabled:shadow-none" disabled>
                        X√≥a Preset
                    </button>
                </div>
            </div>
        </div>
        <div id="input-section" class="bg-blue-50 p-5 rounded-xl shadow-lg mb-8 transition duration-300 hover:shadow-xl">
            
             <div class="mb-4 bg-red-100 p-4 rounded-lg border-2 border-red-400 border-dashed">
                <p class="text-sm font-bold text-gray-800 block mb-3">
                    Ph∆∞∆°ng ph√°p nh·∫≠p d·ªØ li·ªáu:
                </p>
                 <button id="show_timesheet_modal_btn" 
                        onclick="showModal()"
                        class="mt-1 w-full bg-blue-600 hover:bg-blue-700 active:scale-95 text-white font-bold py-2 px-4 rounded-md transition duration-150 shadow-md flex items-center justify-center">
                    üî¢ Nh·∫≠p D·ªØ Li·ªáu C√¥ng T·∫°i ƒê√¢y
                </button>
            </div>
            <h2 class="text-xl font-bold section-title text-blue-800 mb-4">1. S·ªë Li·ªáu ƒê·∫ßu V√†o & M·ª©c L∆∞∆°ng</h2>
            <div class="grid grid-cols-2 gap-4">
                <div class="input-group">
                    <label for="luong_co_ban_input" class="text-blue-700 font-bold">L∆∞∆°ng C∆° B·∫£n</label>
                    <input type="number" id="luong_co_ban_input" value="0" min="0" 
                        autocomplete="off" 
                        onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                        class="w-full p-2 border border-blue-400 rounded-md focus:ring-2 focus:border-blue-500 transition duration-150 bg-white input-bounce-effect">
                </div>
                <div class="input-group">
                    <label for="luong_tinh_tang_ca_input" class="text-blue-700 font-bold">L∆∞∆°ng T√≠nh TƒÉng Ca</label>
                    <input type="number" id="luong_tinh_tang_ca_input" value="0" min="0" 
                        autocomplete="off" 
                        onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                        class="w-full p-2 border border-blue-400 rounded-md focus:ring-2 focus:border-blue-500 transition duration-150 bg-white input-bounce-effect">
                </div>
                <div class="input-group">
                    <label for="ngay_di_lam">S·ªë Ng√†y ƒêi L√†m</label>
                    <input type="number" id="ngay_di_lam" value="0" min="0" 
                        autocomplete="off" 
                        onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                        class="w-full p-2 border border-blue-300 rounded-md focus:ring-2 focus:border-blue-500 transition duration-150 input-bounce-effect">
                </div>
                <div class="input-group">
                    <label for="pc_chuyen_can_input">Chuy√™n C·∫ßn</label>
                    <input type="number" id="pc_chuyen_can_input" value="0" min="0" 
                        autocomplete="off" 
                        onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                        class="w-full p-2 border border-blue-300 rounded-md focus:ring-2 focus:border-blue-500 transition duration-150 input-bounce-effect">
                </div>
                <div class="input-group">
                    <label for="pc_trach_nhiem_input">Tr√°ch Nhi·ªám</label>
                    <input type="number" id="pc_trach_nhiem_input" value="0" min="0" 
                        autocomplete="off" 
                        onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                        class="w-full p-2 border border-blue-300 rounded-md focus:ring-2 focus:border-blue-500 transition duration-150 input-bounce-effect">
                </div>
                <div class="input-group">
                    <label for="pc_tham_nien_input" class="text-blue-700 font-bold">Th√¢m Ni√™n</label>
                    <input type="number" id="pc_tham_nien_input" value="0" min="0" 
                        autocomplete="off" 
                        onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                        class="w-full p-2 border border-blue-300 rounded-md focus:ring-2 focus:border-blue-500 transition duration-150 input-bounce-effect">
                </div>
                <div class="input-group">
                    <label for="pc_tay_nghe_input" class="text-blue-700 font-bold">Tay Ngh·ªÅ</label>
                    <input type="number" id="pc_tay_nghe_input" value="0" min="0" 
                        autocomplete="off" 
                        onfocus="clearZero(this)" onblur="setZeroIfEmpty(this)"
                        class="w-full p-2 border border-blue-300 rounded-md focus:ring-2 focus:border-blue-500 transition duration-150 input-bounce-effect">
                </div>
                
                <div class="col-span-2 grid grid-cols-2 gap-4 mt-2 border-t pt-4 border-blue-200 p-4 rounded-lg bg-white shadow-inner transition duration-300 hover:shadow-md">
                    <p class="col-span-2 text-center text-sm font-bold text-red-500">
                        **Nh·ªØng th√¥ng tin n√†y ƒë∆∞·ª£c nh·∫≠p t·ª´ Ph∆∞∆°ng Ph√°p Nh·∫≠p.**
                    </p>
                    
                    <div class="flex flex-col space-y-3">
                        <p class="text-base font-bold text-gray-700 mb-1">Gi·ªù TƒÉng Ca:</p>
                        
                        <div class="flex items-center input-group">
                            <label for="tc_thuong" class="w-1/2 text-sm">TƒÉng ca Th∆∞·ªùng:</label>
                            <input type="number" id="tc_thuong" value="0" min="0" disabled
                                class="w-1/2 p-2 border border-gray-300 rounded-md bg-gray-100 text-right">
                        </div>
                        <div class="flex items-center input-group">
                            <label for="tc_nghi" class="w-1/2 text-sm">TƒÉng ca Ng√†y Ngh·ªâ:</label>
                            <input type="number" id="tc_nghi" value="0" min="0" disabled
                                class="w-1/2 p-2 border border-gray-300 rounded-md bg-gray-100 text-right">
                        </div>
                        <div class="flex items-center input-group">
                            <label for="tc_le" class="w-1/2 text-sm">TƒÉng ca Ng√†y L·ªÖ:</label>
                            <input type="number" id="tc_le" value="0" min="0" disabled
                                class="w-1/2 p-2 border border-gray-300 rounded-md bg-gray-100 text-right">
                        </div>
                    </div>

                    <div class="flex flex-col space-y-3">
                        <p class="text-base font-bold text-gray-700 mb-1">Gi·ªù Ca ƒê√™m:</p>
                        
                        <div class="flex items-center input-group">
                            <label for="cd_30" class="w-1/2 text-sm">Ca ƒê√™m 30%:</label>
                            <input type="number" id="cd_30" value="0" min="0" disabled
                                class="w-1/2 p-2 border border-gray-300 rounded-md bg-gray-100 text-right">
                        </div>
                        <div class="flex items-center input-group">
                            <label for="cd_50" class="w-1/2 text-sm">Ca ƒê√™m 50%:</label>
                            <input type="number" id="cd_50" value="0" min="0" disabled
                                class="w-1/2 p-2 border border-gray-300 rounded-md bg-gray-100 text-right">
                        </div>
                         <div class="flex items-center input-group">
                            <label for="cd_70" class="w-1/2 text-sm">Ca ƒê√™m 70%:</label>
                            <input type="number" id="cd_70" value="0" min="0" disabled
                                class="w-1/2 p-2 border border-gray-300 rounded-md bg-gray-100 text-right">
                        </div>
                        <div class="flex items-center input-group">
                            <label for="cd_90" class="w-1/2 text-sm">Ca ƒê√™m 90%:</label>
                            <input type="number" id="cd_90" value="0" min="0" disabled
                                class="w-1/2 p-2 border border-gray-300 rounded-md bg-gray-100 text-right">
                        </div>
                    </div>
                </div>
                </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div class="p-6 bg-yellow-100 rounded-xl shadow-lg border-l-4 border-yellow-500 transition duration-300 hover:scale-[1.01]">
                <p class="text-sm font-medium text-yellow-800">T·ªîNG THU NH·∫¨P</p>
                <p id="tong_thu_nhap" class="text-2xl font-extrabold text-yellow-700 mt-1 result-display">0 VNƒê</p>
            </div>
             <div class="p-6 bg-red-100 rounded-xl shadow-lg border-l-4 border-red-500 transition duration-300 hover:scale-[1.01]">
                <p class="text-sm font-medium text-red-800">TH·ª∞C L√ÉNH (KH·ªêI CH√çNH)</p>
                <p id="thuc_lanh" class="text-3xl font-extrabold final-result mt-1 result-display">0 VNƒê</p>
            </div>
        </div>


        <div class="border border-gray-300 rounded-xl overflow-hidden shadow-lg"> 

            <div class="bg-white p-5 border-b border-gray-200">
                <h2 id="toggle_ttcb" class="text-xl font-bold section-title text-gray-800 cursor-pointer flex justify-between items-center hover:bg-blue-50 p-2 -m-2 rounded-lg transition duration-150 active:scale-[0.99]">
                    2. Th√¥ng Tin C∆° B·∫£n <span id="ttcb_arrow" class="transition-transform duration-300 transform rotate-0 text-blue-500">‚ñº</span>
                </h2>
                <div id="content_ttcb" class="space-y-2 text-sm pt-4 hidden border-t mt-4 transition-all duration-300 overflow-hidden">
                    <p>L∆∞∆°ng C∆° B·∫£n: <span id="display_luong_co_ban" class="font-bold text-blue-600">0 VNƒê</span></p>
                    <p>Ng√†y ƒêi L√†m Th·ª±c T·∫ø: <span id="display_ngay_lam" class="font-bold text-gray-700">0</span> ng√†y</p>
                    <p>Ti·ªÅn 1 Gi·ªù L√†m: <span id="tien_1_gio_lam" class="result-value">0 VNƒê</span></p>
                    <p>Ti·ªÅn 1 Ng√†y L√†m: <span id="tien_1_ngay_lam" class="result-value">0 VNƒê</span></p>
                    <p>S·ªë Gi·ªù L√†m Vi·ªác: <span id="so_gio_lam_viec" class="result-value">0 gi·ªù</span></p>
                    <p class="pt-2 border-t mt-2">L∆∞∆°ng Th·ª±c T·∫ø: <span id="luong_thuc_te" class="text-base font-bold text-green-700">0 VNƒê</span></p>
                </div>
            </div>

            <div class="bg-white p-5 border-b border-gray-200">
                <h2 id="toggle_tc" class="text-xl font-bold section-title text-gray-800 cursor-pointer flex justify-between items-center hover:bg-blue-50 p-2 -m-2 rounded-lg transition duration-150 active:scale-[0.99]">
                    3. T√≠nh Gi·ªù TƒÉng Ca <span id="tc_arrow" class="transition-transform duration-300 transform rotate-0 text-blue-500">‚ñº</span>
                </h2>
                
                <p class="pt-2 border-t mt-2 text-sm">
                    T·ªïng Gi·ªù TƒÉng Ca: <span id="tong_gio_tang_ca" class="text-base font-bold text-green-700">0 VNƒê</span>
                </p>

                <div id="content_tc" class="space-y-2 text-sm pt-4 hidden border-t mt-4 transition-all duration-300 overflow-hidden">
                    <p>L∆∞∆°ng T√≠nh TƒÉng Ca: <span id="display_luong_tinh_tang_ca" class="font-bold text-blue-600">0 VNƒê</span></p>
                    <p>Ti·ªÅn 1 Gi·ªù TƒÉng Ca (Base): <span id="tien_1_gio_tc" class="result-value">0 VNƒê</span></p>
                    <p>TƒÉng Ca Th∆∞·ªùng (150%): <span id="tc_thuong_tien" class="result-value">0 VNƒê</span></p>
                    <p>TƒÉng Ca Ng√†y Ngh·ªâ (200%): <span id="tc_nghi_tien" class="result-value">0 VNƒê</span></p>
                    <p>TƒÉng Ca Ng√†y L·ªÖ (300%): <span id="tc_le_tien" class="result-value">0 VNƒê</span></p>
                    <p>Ca ƒê√™m 30% (Ph·ª• c·∫•p): <span id="cd_30_tien" class="result-value">0 VNƒê</span></p>
                    <p>Ca ƒê√™m 50% (Ph·ª• c·∫•p): <span id="cd_50_tien" class="result-value">0 VNƒê</span></p>
                    <p>Ca ƒê√™m 70% (Ph·ª• c·∫•p): <span id="cd_70_tien" class="result-value">0 VNƒê</span></p>
                    <p>Ca ƒê√™m 90% (Ph·ª• c·∫•p): <span id="cd_90_tien" class="result-value">0 VNƒê</span></p>
                </div>
            </div>

            <div class="bg-white p-5 border-b border-gray-200">
                <h2 id="toggle_pc" class="text-xl font-bold section-title text-gray-800 cursor-pointer flex justify-between items-center hover:bg-blue-50 p-2 -m-2 rounded-lg transition duration-150 active:scale-[0.99]">
                    4. C√°c Kho·∫£n Ph·ª• C·∫•p <span id="pc_arrow" class="transition-transform duration-300 transform rotate-0 text-blue-500">‚ñº</span>
                </h2>
                
                <p class="pt-2 border-t mt-2 text-sm">
                    T·ªïng C√°c Kho·∫£n Ph·ª• C·∫•p: <span id="tong_phu_cap" class="text-base font-bold text-green-700">0 VNƒê</span>
                </p>

                <div id="content_pc" class="space-y-2 text-sm pt-4 hidden border-t mt-4 transition-all duration-300 overflow-hidden">
                    <p>Ph·ª• C·∫•p Tr√¨nh ƒê·ªô : <span id="pc_trinh_do" class="result-value">0 VNƒê</span></p> <p>Ph·ª• C·∫•p Tr√°ch Nhi·ªám : <span id="pc_trach_nhiem_result" class="font-bold text-gray-700">0 VNƒê</span></p>
                    <p class="font-bold text-gray-700">Ph·ª• C·∫•p Th√¢m Ni√™n: <span id="pc_tham_nien_result" class="font-bold text-gray-700">0 VNƒê</span></p>
                    <p class="font-bold text-blue-700">Ph·ª• C·∫•p Tay Ngh·ªÅ : <span id="pc_tay_nghe_result" class="font-bold text-blue-700">0 VNƒê</span></p>
                    <p>Ph·ª• C·∫•p Chuy√™n C·∫ßn : <span id="pc_chuyen_can_result" class="font-bold text-gray-700">0 VNƒê</span></p>
                    <p>H·ªó Tr·ª£ ƒêi L·∫°i : <span class="font-bold text-gray-700">250,000 VNƒê</span></p>
                    <p>Ti·ªÅn Th∆∞·ªüng : <span class="font-bold text-gray-700">50,000 VNƒê</span></p>
                </div>
            </div>

            <div class="bg-white p-5">
                <h2 id="toggle_kt" class="text-xl font-bold section-title text-gray-800 cursor-pointer flex justify-between items-center hover:bg-blue-50 p-2 -m-2 rounded-lg transition duration-150 active:scale-[0.99]">
                    5. C√°c Kho·∫£n Kh·∫•u Tr·ª´ <span id="kt_arrow" class="transition-transform duration-300 transform rotate-0 text-blue-500">‚ñº</span>
                </h2>
                
                <p class="pt-2 border-t mt-2 text-sm">
                    T·ªïng C√°c Kho·∫£n Kh·∫•u Tr·ª´: <span id="tong_khau_tru" class="text-base font-bold text-red-700">0 VNƒê</span>
                </p>
                
                <div id="content_kt" class="space-y-2 text-sm pt-4 hidden border-t mt-4 transition-all duration-300 overflow-hidden">
                    <p class="text-sm italic text-gray-500 mb-3">T√≠nh tr√™n L∆∞∆°ng T√≠nh Gi·ªù TƒÉng Ca: <span id="display_kh_luong_bh" class="font-medium">0 VNƒê</span></p>
                    <p>B·∫£o Hi·ªÉm Y T·∫ø (1.5%): <span id="kh_bhyt" class="font-bold text-red-600">0 VNƒê</span></p>
                    <p>B·∫£o Hi·ªÉm Tai N·∫°n (1%): <span id="kh_bhtn" class="font-bold text-red-600">0 VNƒê</span></p>
                    <p>B·∫£o Hi·ªÉm X√£ H·ªôi (8%): <span id="kh_bhxh" class="font-bold text-red-600">0 VNƒê</span></p>
                    <p>Ph√≠ C√¥ng ƒêo√†n : <span class="font-bold text-red-600">49,600 VNƒê</span></p>
                    <p>Ti·ªÅn Ti·∫øt Ki·ªám: <span class="font-bold text-red-600">200,000 VNƒê</span></p>
                    <p>Ti·ªÅn T·ª´ Thi·ªán : <span class="font-bold text-red-600">8,000 VNƒê</span></p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // H√†m ƒë·ªãnh d·∫°ng s·ªë sang ti·ªÅn t·ªá Vi·ªát Nam ƒê·ªìng (ƒê√£ th·ªëng nh·∫•t d√πng VNƒê)
        const formatVND = (amount) => {
            if (typeof amount !== 'number' || isNaN(amount)) return '0 VNƒê';
            
            // 1. D√πng Intl.NumberFormat ƒë·ªÉ ƒë·ªãnh d·∫°ng s·ªë v√† d·∫•u ph√¢n c√°ch h√†ng ngh√¨n
            const formattedNumber = new Intl.NumberFormat('vi-VN', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(Math.round(amount));

            // 2. Tr·∫£ v·ªÅ chu·ªói k√®m theo ƒë∆°n v·ªã VNƒê th·ªëng nh·∫•t
            return formattedNumber + ' VNƒê';
        };

        // ----------------------------------------------------
        // C√ÅC H·∫∞NG S·ªê C·ªê ƒê·ªäNH 
        // ----------------------------------------------------
        const NGAY_CHUAN = 26;
        const GIO_CHUAN_NGAY = 8;
        
        // 3. C√°c Kho·∫£n Ph·ª• C·∫•p C·ªë ƒê·ªãnh
        const PC_HE_SO_TRINH_DO = 5769.22; // Ph·ª• c·∫•p tr√¨nh ƒë·ªô/Tay ngh·ªÅ (ti·ªÅn/ng√†y)
        const PC_HO_TRO_DI_LAI = 250000;
        const PC_TIEN_THUONG = 50000;

        // 4. C√°c Kho·∫£n Kh·∫•u Tr·ª´ C·ªë ƒê·ªãnh & T·ª∑ l·ªá
        const KH_BHYT_RATE = 0.015;
        const KH_BHTN_RATE = 0.01;
        const KH_BHXH_RATE = 0.08;
        const KH_PHI_CONG_DOAN = 49600;
        const KH_TIEN_TIET_KIEM = 200000;
        const KH_TIEN_TU_THIEN = 8000;

        // ----------------------------------------------------
        // H√ÄM X·ª¨ L√ù NH·∫¨P LI·ªÜU (X√ìA S·ªê 0)
        // ----------------------------------------------------
        function clearZero(inputElement) {
            if (inputElement.value === '0') {
                inputElement.value = '';
            }
        }

        function setZeroIfEmpty(inputElement) {
            if (inputElement.value === '') {
                inputElement.value = '0';
            }
            // ƒê·∫£m b·∫£o t√≠nh l∆∞∆°ng ƒë∆∞·ª£c g·ªçi khi ng∆∞·ªùi d√πng r·ªùi kh·ªèi √¥
            calculateSalary();
        }


        // ----------------------------------------------------
        // H√ÄM T√çNH TO√ÅN V√Ä ANIMATION
        // ----------------------------------------------------

        // H√†m trigger animation c·∫≠p nh·∫≠t
        function triggerUpdateAnimation(elementId) {
            const el = document.getElementById(elementId);
            if (el) {
                // Animation cho ph·∫ßn t·ª≠ gi√° tr·ªã
                el.classList.remove('animate-update');
                void el.offsetWidth; 
                el.classList.add('animate-update');
            }
        }
        
        // H√†m trigger animation cho Bong b√≥ng n·ªïi
        function triggerBubbleAnimation() {
             const bubble = document.getElementById('floating-result-bubble');
             if (bubble) {
                 bubble.classList.remove('animate-update-bubble');
                 void bubble.offsetWidth; 
                 bubble.classList.add('animate-update-bubble');
             }
        }
        
        // --- H√ÄM QU·∫¢N L√ù MODAL (B·∫¢NG H·ªéI) ---
        function showModal() {
            // L·∫•y d·ªØ li·ªáu hi·ªán t·∫°i t·ª´ input ch√≠nh ƒë·ªÉ ƒë·ªï v√†o modal
            document.getElementById('modal_ngay_di_lam').value = document.getElementById('ngay_di_lam').value;
            document.getElementById('modal_tc_thuong').value = document.getElementById('tc_thuong').value;
            document.getElementById('modal_tc_nghi').value = document.getElementById('tc_nghi').value;
            document.getElementById('modal_tc_le').value = document.getElementById('tc_le').value;
            document.getElementById('modal_cd_30').value = document.getElementById('cd_30').value;
            document.getElementById('modal_cd_50').value = document.getElementById('cd_50').value;
            document.getElementById('modal_cd_70').value = document.getElementById('cd_70').value;
            document.getElementById('modal_cd_90').value = document.getElementById('cd_90').value;

            document.getElementById('timesheet-modal').classList.add('active');
        }

        function closeModal(event) {
            // ƒê√≥ng modal khi b·∫•m v√†o n√∫t X ho·∫∑c l·ªõp ph·ªß (tr·ª´ n·ªôi dung modal)
            if (event === undefined || event.target.id === 'timesheet-modal') {
                document.getElementById('timesheet-modal').classList.remove('active');
            }
        }

        function applyModalData() {
            // 1. L·∫•y d·ªØ li·ªáu t·ª´ modal
            const ngayDiLamModal = document.getElementById('modal_ngay_di_lam').value || 0;
            const tcThuongModal = document.getElementById('modal_tc_thuong').value || 0;
            const tcNghiModal = document.getElementById('modal_tc_nghi').value || 0;
            const tcLeModal = document.getElementById('modal_tc_le').value || 0;
            const cd30Modal = document.getElementById('modal_cd_30').value || 0;
            const cd50Modal = document.getElementById('modal_cd_50').value || 0;
            const cd70Modal = document.getElementById('modal_cd_70').value || 0;
            const cd90Modal = document.getElementById('modal_cd_90').value || 0;

            // 2. ƒê·ªï d·ªØ li·ªáu v√†o c√°c input ch√≠nh (·∫©n)
            document.getElementById('ngay_di_lam').value = ngayDiLamModal;
            document.getElementById('tc_thuong').value = tcThuongModal;
            document.getElementById('tc_nghi').value = tcNghiModal;
            document.getElementById('tc_le').value = tcLeModal;
            document.getElementById('cd_30').value = cd30Modal;
            document.getElementById('cd_50').value = cd50Modal;
            document.getElementById('cd_70').value = cd70Modal;
            document.getElementById('cd_90').value = cd90Modal;

            // 3. ƒê√≥ng modal
            closeModal();

            // 4. T√≠nh to√°n l·∫°i l∆∞∆°ng
            calculateSalary();
            alert("S·ªë li·ªáu c√¥ng ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!");
        }
        // --- K·∫æT TH√öC H√ÄM QU·∫¢N L√ù MODAL ---


        let previousThucLanh = 0;
        let previousTongThuNhap = 0;

        function calculateSalary() {
            // 1. S·ªë Li·ªáu ƒê·∫ßu V√†o (Input)
            // ƒê√£ c·∫≠p nh·∫≠t onfocus/onblur n√™n kh√¥ng c·∫ßn h√†m if (this.value=='0') this.value=''; n·ªØa
            const luong_co_ban_input = parseFloat(document.getElementById('luong_co_ban_input').value) || 0;
            const luong_tinh_tang_ca_input = parseFloat(document.getElementById('luong_tinh_tang_ca_input').value) || 0;
            
            // L·∫•y s·ªë li·ªáu c√¥ng t·ª´ input ch√≠nh (ƒë√£ b·ªã ·∫©n/v√¥ hi·ªáu h√≥a nh∆∞ng v·∫´n gi·ªØ gi√° tr·ªã)
            const ngay_di_lam = parseFloat(document.getElementById('ngay_di_lam').value) || 0;
            const tc_thuong = parseFloat(document.getElementById('tc_thuong').value) || 0;
            const tc_nghi = parseFloat(document.getElementById('tc_nghi').value) || 0;
            const tc_le = parseFloat(document.getElementById('tc_le').value) || 0;
            const cd_30 = parseFloat(document.getElementById('cd_30').value) || 0;
            const cd_50 = parseFloat(document.getElementById('cd_50').value) || 0;
            const cd_70 = parseFloat(document.getElementById('cd_70').value) || 0;
            const cd_90 = parseFloat(document.getElementById('cd_90').value) || 0;

            // Ph·ª• c·∫•p kh√°c
            const pc_chuyen_can_input = parseFloat(document.getElementById('pc_chuyen_can_input').value) || 0;
            const pc_trach_nhiem_input = parseFloat(document.getElementById('pc_trach_nhiem_input').value) || 0; 
            const pc_tham_nien_input = parseFloat(document.getElementById('pc_tham_nien_input').value) || 0; 
            const pc_tay_nghe_input = parseFloat(document.getElementById('pc_tay_nghe_input').value) || 0; 

            const LuongCoBan = luong_co_ban_input;
            const LuongTinhTangCa = luong_tinh_tang_ca_input;
            const NgayDiLamThucTe = Math.max(0, ngay_di_lam);


            // 2. Th√¥ng Tin C∆° B·∫£n
            document.getElementById('display_luong_co_ban').textContent = formatVND(LuongCoBan);
            document.getElementById('display_ngay_lam').textContent = NgayDiLamThucTe;

            const Tien1GioLam = LuongCoBan > 0 ? LuongCoBan / NGAY_CHUAN / GIO_CHUAN_NGAY : 0;
            document.getElementById('tien_1_gio_lam').textContent = formatVND(Tien1GioLam);

            const Tien1NgayLam = LuongCoBan > 0 ? LuongCoBan / NGAY_CHUAN : 0;
            document.getElementById('tien_1_ngay_lam').textContent = formatVND(Tien1NgayLam);

            const SoGioLamViec = NgayDiLamThucTe * GIO_CHUAN_NGAY;
            document.getElementById('so_gio_lam_viec').textContent = SoGioLamViec + ' gi·ªù'; // Gi·ªØ l·∫°i ƒë∆°n v·ªã gi·ªù

            const LuongThucTe = Tien1GioLam * SoGioLamViec;
            document.getElementById('luong_thuc_te').textContent = formatVND(LuongThucTe);


            // 3. T√≠nh Gi·ªù TƒÉng Ca
            document.getElementById('display_luong_tinh_tang_ca').textContent = formatVND(LuongTinhTangCa);

            const Tien1GioTangCaBase = LuongTinhTangCa > 0 ? LuongTinhTangCa / NGAY_CHUAN / GIO_CHUAN_NGAY : 0;
            document.getElementById('tien_1_gio_tc').textContent = formatVND(Tien1GioTangCaBase);

            // C√¥ng th·ª©c: Ti·ªÅn 1 Gi·ªù TƒÉng Ca * S·ªë Gi·ªù * H·ªá s·ªë
            const TangCaThuong = Tien1GioTangCaBase * tc_thuong * 1.5;
            const TangCaNgayNghi = Tien1GioTangCaBase * tc_nghi * 2.0;
            const TangCaNgayLe = Tien1GioTangCaBase * tc_le * 3.0;
            const CaDem30 = Tien1GioTangCaBase * cd_30 * 0.3;
            const CaDem50 = Tien1GioTangCaBase * cd_50 * 0.5;
            const CaDem70 = Tien1GioTangCaBase * cd_70 * 0.7;
            const CaDem90 = Tien1GioTangCaBase * cd_90 * 0.9;

            document.getElementById('tc_thuong_tien').textContent = formatVND(TangCaThuong);
            document.getElementById('tc_nghi_tien').textContent = formatVND(TangCaNgayNghi);
            document.getElementById('tc_le_tien').textContent = formatVND(TangCaNgayLe);
            document.getElementById('cd_30_tien').textContent = formatVND(CaDem30);
            document.getElementById('cd_50_tien').textContent = formatVND(CaDem50);
            document.getElementById('cd_70_tien').textContent = formatVND(CaDem70);
            document.getElementById('cd_90_tien').textContent = formatVND(CaDem90);

            const TongGioTangCa = TangCaThuong + TangCaNgayNghi + TangCaNgayLe + CaDem30 + CaDem50 + CaDem70 + CaDem90;
            document.getElementById('tong_gio_tang_ca').textContent = formatVND(TongGioTangCa);


            // 4. C√°c Kho·∫£n Ph·ª• C·∫•p
            // Ph·ª• c·∫•p Tay Ngh·ªÅ t√≠nh theo c√¥ng th·ª©c c≈© (tr∆∞·ªõc ƒë√¢y l√† Tr√¨nh ƒê·ªô)
            const PhuCapTayNgheCongThuc = PC_HE_SO_TRINH_DO * NgayDiLamThucTe; 
            document.getElementById('pc_trinh_do').textContent = formatVND(PhuCapTayNgheCongThuc);
            
            // L·∫•y c√°c ph·ª• c·∫•p t·ª´ input
            const PC_CHUYEN_CAN = pc_chuyen_can_input;
            const PC_TRACH_NHIEM = pc_trach_nhiem_input;
            const PC_THAM_NIEN = pc_tham_nien_input;
            const PC_TAY_NGHE = pc_tay_nghe_input; 

            document.getElementById('pc_chuyen_can_result').textContent = formatVND(PC_CHUYEN_CAN);
            document.getElementById('pc_trach_nhiem_result').textContent = formatVND(PC_TRACH_NHIEM);
            document.getElementById('pc_tham_nien_result').textContent = formatVND(PC_THAM_NIEN);
            document.getElementById('pc_tay_nghe_result').textContent = formatVND(PC_TAY_NGHE); 

            const TongPhuCap = PhuCapTayNgheCongThuc + PC_TRACH_NHIEM + PC_THAM_NIEN + PC_TAY_NGHE + PC_CHUYEN_CAN + PC_HO_TRO_DI_LAI + PC_TIEN_THUONG;
            document.getElementById('tong_phu_cap').textContent = formatVND(TongPhuCap);


            // 5. C√°c Kho·∫£n Kh·∫•u Tr·ª´
            const LuongTinhGiaTangCa = LuongTinhTangCa; 
            document.getElementById('display_kh_luong_bh').textContent = formatVND(LuongTinhGiaTangCa);

            const KH_BHYT = LuongTinhGiaTangCa * KH_BHYT_RATE;
            const KH_BHTN = LuongTinhGiaTangCa * KH_BHTN_RATE;
            const KH_BHXH = LuongTinhGiaTangCa * KH_BHXH_RATE;
            document.getElementById('kh_bhyt').textContent = formatVND(KH_BHYT);
            document.getElementById('kh_bhtn').textContent = formatVND(KH_BHTN);
            document.getElementById('kh_bhxh').textContent = formatVND(KH_BHXH);

            const TongKhauTru = KH_BHYT + KH_BHTN + KH_BHXH + KH_PHI_CONG_DOAN + KH_TIEN_TIET_KIEM + KH_TIEN_TU_THIEN;
            document.getElementById('tong_khau_tru').textContent = formatVND(TongKhauTru);


            // 6. T·ªïng Thu Nh·∫≠p
            const TongThuNhap = LuongThucTe + TongGioTangCa + TongPhuCap;
            document.getElementById('tong_thu_nhap').textContent = formatVND(TongThuNhap);
            
            // Animation cho T·ªïng Thu Nh·∫≠p
            if (TongThuNhap !== previousTongThuNhap) {
                triggerUpdateAnimation('tong_thu_nhap');
                previousTongThuNhap = TongThuNhap;
            }


            // 7. Th·ª±c L√£nh
            const ThucLanh = TongThuNhap - TongKhauTru;
            
            // C·∫≠p nh·∫≠t gi√° tr·ªã Th·ª±c L√£nh ·ªü c·∫£ hai n∆°i: Kh·ªëi ch√≠nh v√† Bong b√≥ng n·ªïi
            document.getElementById('thuc_lanh').textContent = formatVND(ThucLanh); // Kh·ªëi gi·ªØ ch·ªó
            document.getElementById('thuc_lanh_fab').textContent = formatVND(ThucLanh); // Bong b√≥ng n·ªïi
            
            // Animation cho Th·ª±c L√£nh (c·∫£ kh·ªëi ch√≠nh v√† bong b√≥ng)
            if (ThucLanh !== previousThucLanh) {
                triggerUpdateAnimation('thuc_lanh'); // Animation kh·ªëi ch√≠nh
                triggerBubbleAnimation(); // Animation bong b√≥ng n·ªïi
                previousThucLanh = ThucLanh;
            }
        }

        // ----------------------------------------------------
        // QU·∫¢N L√ù PRESET C√Å NH√ÇN (LOCAL STORAGE)
        // ----------------------------------------------------

        const PRESET_INPUT_IDS = [
            'luong_co_ban_input', 'luong_tinh_tang_ca_input', 'ngay_di_lam', 
            'pc_chuyen_can_input', 'pc_trach_nhiem_input', 'pc_tham_nien_input', 'pc_tay_nghe_input', 
            'tc_thuong', 'tc_nghi', 'tc_le', 'cd_30', 'cd_50', 'cd_70', 'cd_90'
        ];
        
        // Load danh s√°ch Preset t·ª´ LocalStorage
        function loadPresets() {
            const selectElement = document.getElementById('preset_select');
            const storedPresets = JSON.parse(localStorage.getItem('salaryPresets') || '{}');
            
            // X√≥a c√°c option c≈©
            selectElement.innerHTML = '<option value="">-- Ch·ªçn Preset ƒë·ªÉ T·∫£i S·ªë Li·ªáu --</option>';

            // Th√™m c√°c preset ƒë√£ l∆∞u
            for (const name in storedPresets) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                selectElement.appendChild(option);
            }
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
            updatePresetButtons();
        }

        // L∆∞u Preset hi·ªán t·∫°i
        function savePreset() {
            const nameInput = document.getElementById('preset_name_input');
            let presetName = nameInput.value.trim();

            if (!presetName) {
                alert("Vui l√≤ng nh·∫≠p T√™n Preset ƒë·ªÉ l∆∞u!");
                return;
            }

            const storedPresets = JSON.parse(localStorage.getItem('salaryPresets') || '{}');
            const newPresetData = {};

            // L·∫•y d·ªØ li·ªáu t·ª´ c√°c input hi·ªán t·∫°i
            PRESET_INPUT_IDS.forEach(id => {
                newPresetData[id] = document.getElementById(id).value;
            });

            // L∆∞u ho·∫∑c c·∫≠p nh·∫≠t Preset
            storedPresets[presetName] = newPresetData;
            localStorage.setItem('salaryPresets', JSON.stringify(storedPresets));
            
            alert(`Preset "${presetName}" ƒë√£ ƒë∆∞·ª£c l∆∞u/c·∫≠p nh·∫≠t th√†nh c√¥ng!`);
            
            // T·∫£i l·∫°i danh s√°ch v√† ch·ªçn t√™n v·ª´a l∆∞u
            loadPresets();
            document.getElementById('preset_select').value = presetName;
            nameInput.value = ''; // X√≥a t√™n input sau khi l∆∞u
            updatePresetButtons();
        }

        /**
         * T·∫£i d·ªØ li·ªáu t·ª´ Preset ƒë√£ ch·ªçn v√†o c√°c Input Field v√† h·ªèi v·ªÅ Chuy√™n C·∫ßn.
         */
        function loadPresetData() {
            const selectElement = document.getElementById('preset_select');
            const pcChuyenCanInput = document.getElementById('pc_chuyen_can_input');
            const presetName = selectElement.value;

            if (!presetName) {
                alert("Vui l√≤ng ch·ªçn m·ªôt Preset ƒë·ªÉ t·∫£i!");
                return;
            }

            const storedPresets = JSON.parse(localStorage.getItem('salaryPresets') || '{}');
            const presetData = storedPresets[presetName];

            if (presetData) {
                // Bi·∫øn t·∫°m ƒë·ªÉ l∆∞u gi√° tr·ªã Chuy√™n C·∫ßn t·ª´ preset (N·∫øu c√≥)
                let chuyenCanValueFromPreset = parseFloat(presetData['pc_chuyen_can_input']) || 0;
                
                // 1. ƒê·ªï d·ªØ li·ªáu t·ª´ Preset v√†o c√°c Input ch√≠nh (v√† ƒë·ªìng b·ªô v·ªõi modal)
                PRESET_INPUT_IDS.forEach(id => {
                    const value = String(presetData[id] || '0');
                    document.getElementById(id).value = value;
                    
                    // ƒê·ªìng b·ªô v·ªõi input trong modal n·∫øu c√≥
                    if (id === 'ngay_di_lam') document.getElementById('modal_ngay_di_lam').value = value;
                    if (id === 'tc_thuong') document.getElementById('modal_tc_thuong').value = value;
                    if (id === 'tc_nghi') document.getElementById('modal_tc_nghi').value = value;
                    if (id === 'tc_le') document.getElementById('modal_tc_le').value = value;
                    if (id === 'cd_30') document.getElementById('modal_cd_30').value = value;
                    if (id === 'cd_50') document.getElementById('modal_cd_50').value = value;
                    if (id === 'cd_70') document.getElementById('modal_cd_70').value = value;
                    if (id === 'cd_90') document.getElementById('modal_cd_90').value = value;
                });

                // 2. LOGIC X·ª¨ L√ù CHUY√äN C·∫¶N
                
                // S·ª≠ d·ª•ng window.confirm ƒë·ªÉ t·∫°o h·ªôp tho·∫°i "C√≥/Kh√¥ng"
                const confirmResult = confirm(`Preset "${presetName}" ƒë√£ ƒë∆∞·ª£c t·∫£i. Th√°ng n√†y b·∫°n c√≥ ƒë∆∞·ª£c th∆∞·ªüng CHUY√äN C·∫¶N kh√¥ng?`);

                if (confirmResult) {
                    // Ng∆∞·ªùi d√πng ch·ªçn "C√≥"
                    // ƒêi·ªÅn 300,000 v√†o √¥ Chuy√™n C·∫ßn
                    pcChuyenCanInput.value = 300000;
                    alert("ƒê√£ √°p d·ª•ng Ph·ª• C·∫•p Chuy√™n C·∫ßn: 300,000 VNƒê.");
                } else {
                    // Ng∆∞·ªùi d√πng ch·ªçn "Kh√¥ng"
                    // X√≥a d·ªØ li·ªáu Chuy√™n C·∫ßn hi·ªán t·∫°i (ƒë·∫∑t v·ªÅ 0)
                    if (chuyenCanValueFromPreset > 0) { 
                         pcChuyenCanInput.value = 0;
                         alert("ƒê√£ x√≥a Ph·ª• C·∫•p Chuy√™n C·∫ßn (0 VNƒê).");
                    }
                }
                
                // 3. Ch·∫°y l·∫°i t√≠nh to√°n
                calculateSalary();
                alert(`Preset "${presetName}" ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng!`);
            }
        }
        
        // X√≥a Preset ƒë√£ ch·ªçn
        function deletePreset() {
            const selectElement = document.getElementById('preset_select');
            const presetName = selectElement.value;
            
            if (!presetName) return;

            if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a Preset "${presetName}"?`)) {
                const storedPresets = JSON.parse(localStorage.getItem('salaryPresets') || '{}');
                delete storedPresets[presetName];
                localStorage.setItem('salaryPresets', JSON.stringify(storedPresets));
                
                alert(`Preset "${presetName}" ƒë√£ ƒë∆∞·ª£c x√≥a!`);
                loadPresets();
            }
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t T·∫£i/X√≥a
        function updatePresetButtons() {
            const selectElement = document.getElementById('preset_select');
            const loadBtn = document.getElementById('load_preset_btn');
            const deleteBtn = document.getElementById('delete_preset_btn');
            const presetNameInput = document.getElementById('preset_name_input');
            
            const selectedName = selectElement.value;

            // K√≠ch ho·∫°t/V√¥ hi·ªáu h√≥a n√∫t T·∫£i/X√≥a
            const shouldBeActive = selectedName !== "";
            loadBtn.disabled = !shouldBeActive;
            deleteBtn.disabled = !shouldBeActive;
            
            // T·ª± ƒë·ªông ƒëi·ªÅn t√™n preset ƒë√£ ch·ªçn v√†o √¥ input n·∫øu mu·ªën c·∫≠p nh·∫≠t
            if (shouldBeActive) {
                presetNameInput.value = selectedName;
            } else {
                 presetNameInput.value = '';
            }
        }

        // ----------------------------------------------------
        // H√ÄM X·ª¨ L√ù COLLAPSIBLE (CH·∫æ ƒê·ªò THU NH·ªé)
        // ----------------------------------------------------
        function setupCollapsibles() {
            const toggles = [
                { id: 'toggle_ttcb', contentId: 'content_ttcb', arrowId: 'ttcb_arrow' },
                { id: 'toggle_tc', contentId: 'content_tc', arrowId: 'tc_arrow' },
                { id: 'toggle_pc', contentId: 'content_pc', arrowId: 'pc_arrow' },
                { id: 'toggle_kt', contentId: 'content_kt', arrowId: 'kt_arrow' },
            ];

            toggles.forEach(item => {
                const toggleEl = document.getElementById(item.id);
                const contentEl = document.getElementById(item.contentId);
                const arrowEl = document.getElementById(item.arrowId);

                if (toggleEl && contentEl) {
                    // M·∫∑c ƒë·ªãnh t·∫•t c·∫£ ƒë·ªÅu b·ªã ·∫©n
                    contentEl.style.maxHeight = '0';
                    contentEl.classList.add('overflow-hidden'); 
                    contentEl.classList.remove('hidden'); 
                    
                    if (arrowEl) {
                        arrowEl.textContent = '‚ñº'; 
                        arrowEl.classList.remove('rotate-180');
                        arrowEl.classList.add('rotate-0');
                    }

                    toggleEl.addEventListener('click', () => {
                        const isCollapsed = contentEl.style.maxHeight === '0px' || contentEl.style.maxHeight === '';
                        
                        if (isCollapsed) {
                             // M·ªü r·ªông
                            contentEl.style.maxHeight = contentEl.scrollHeight + 'px';
                            if (arrowEl) {
                                arrowEl.classList.remove('rotate-0');
                                arrowEl.classList.add('rotate-180');
                                arrowEl.textContent = '‚ñ≤'; 
                            }
                        } else {
                            // Thu g·ªçn
                            contentEl.style.maxHeight = '0';
                            if (arrowEl) {
                                arrowEl.classList.remove('rotate-180');
                                arrowEl.classList.add('rotate-0');
                                arrowEl.textContent = '‚ñº';
                            }
                        }
                    });
                }
            });
        }


        // ----------------------------------------------------
        // KH·ªûI T·∫†O V√Ä S·ª∞ KI·ªÜN
        // ----------------------------------------------------
        window.onload = function() {
            // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi tr√™n c√°c tr∆∞·ªùng input ch√≠nh (Tr·ª´ c√°c √¥ disabled)
            const inputs = document.querySelectorAll('#input-section input[type="number"]:not([disabled])');
            inputs.forEach(input => {
                // S·ª≠ d·ª•ng s·ª± ki·ªán 'input' ƒë·ªÉ t√≠nh to√°n ngay khi g√µ
                input.addEventListener('input', calculateSalary); 
                // Th√™m c√°c h√†m x√≥a 0/ƒë·∫∑t 0 khi focus/blur
                input.addEventListener('focus', function() { clearZero(this); });
                input.addEventListener('blur', function() { setZeroIfEmpty(this); });
            });
            
            // C√†i ƒë·∫∑t ch·∫ø ƒë·ªô thu nh·ªè
            setupCollapsibles();
            
            // S·ª∞ KI·ªÜN PRESET
            document.getElementById('save_preset_btn').addEventListener('click', savePreset);
            document.getElementById('load_preset_btn').addEventListener('click', loadPresetData);
            document.getElementById('delete_preset_btn').addEventListener('click', deletePreset);
            document.getElementById('preset_select').addEventListener('change', updatePresetButtons);

            // T·∫£i danh s√°ch preset khi trang ƒë∆∞·ª£c t·∫£i
            loadPresets(); 

            // Th·ª±c hi·ªán t√≠nh to√°n l·∫ßn ƒë·∫ßu v·ªõi gi√° tr·ªã m·∫∑c ƒë·ªãnh (0)
            calculateSalary();
        }

    </script>
</body>
</html>
